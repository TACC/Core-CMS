{% load static %}

{# Load assets as external files, to cache independently of markup. #}
{% comment %}
FAQ: IF a script or style is better cached with markup, THEN:
  - Such a style belongs inline before relevant markup, not via this block
  - Such a script belongs inline after relevant markup, not via this block
{% endcomment %}

<!-- Custom Assets: Favicon. -->
{% with settings.PORTAL_FAVICON as favicon %}
<link rel="icon" href="{% if favicon.is_remote %}{{ favicon.img_file_src }}{% else %}{% static favicon.img_file_src %}{% endif %}" type="image/x-icon" />
{% endwith %}

<!-- Custom Assets: Styles. -->
{% with settings.PORTAL_STYLES as styles %}
  {% for style in styles %}
    {% with current_page.reverse_id as page_id %}
    {% with CMS_TEMPLATE as page_template %}
    {% with style.page_id as style_id %}
    {% with style.template_name as style_template %}
    {% if style_id == page_id and not style_template or style_template == page_template and not style_id or style_id == page_id and style_template == page_template or not style_id and not style_template %}
    <link rel="stylesheet"

          {% if style.is_remote %}
          href="{{ style.path }}"
          {% else %}
          href="{% static style.path %}"
          {% endif %}

          {% if style_template and style_template == page_template %}
          data-for-template="{{ style.template_name }}"
          {% endif %}
          {% if style_id and style_id == page_id %}
          data-for-page="{{ style.page_id }}"
          {% endif %}
    />
    {% endif %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
  {% endfor %}
{% endwith %}
